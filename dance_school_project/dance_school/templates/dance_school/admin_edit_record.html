{% extends "dance_school/base.html" %}

{% block content %}
<div class="container mt-4">
    <h1>Редактировать запись в таблице: {{ table_display }}</h1>
    
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="table" value="{{ table_name }}">
        <input type="hidden" name="id" value="{{ record_id }}">
        
        <div class="card mb-4">
            <div class="card-body">
                {% if columns_data %}
                    {% for column in columns_data %}
                        {% if column.name != 'client_id' and column.name != 'trainer_id' and column.name != 'dance_style_id' and column.name != 'schedule_id' and column.name != 'registration_id' %}
                        <div class="form-group mb-3">
                            <label for="{{ column.name }}">{{ column.name|title }} ({{ column.data_type }})</label>
                            
                            {% if 'date' in column.name.lower %}
                                <input type="date" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% elif 'time' in column.name.lower %}
                                <input type="time" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% elif 'price' in column.name.lower or 'capacity' in column.name.lower %}
                                <input type="number" step="0.01" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% elif 'status' in column.name.lower %}
                                <select class="form-control" id="{{ column.name }}" name="{{ column.name }}">
                                    <option value="активно" {% if column.current_value == 'активно' %}selected{% endif %}>активно</option>
                                    <option value="неактивно" {% if column.current_value == 'неактивно' %}selected{% endif %}>неактивно</option>
                                    <option value="активен" {% if column.current_value == 'активен' %}selected{% endif %}>активен</option>
                                    <option value="неактивен" {% if column.current_value == 'неактивен' %}selected{% endif %}>неактивен</option>
                                </select>
                            {% elif 'weekday' in column.name.lower %}
                                <select class="form-control" id="{{ column.name }}" name="{{ column.name }}">
                                    <option value="Понедельник" {% if column.current_value == 'Понедельник' %}selected{% endif %}>Понедельник</option>
                                    <option value="Вторник" {% if column.current_value == 'Вторник' %}selected{% endif %}>Вторник</option>
                                    <option value="Среда" {% if column.current_value == 'Среда' %}selected{% endif %}>Среда</option>
                                    <option value="Четверг" {% if column.current_value == 'Четверг' %}selected{% endif %}>Четверг</option>
                                    <option value="Пятница" {% if column.current_value == 'Пятница' %}selected{% endif %}>Пятница</option>
                                    <option value="Суббота" {% if column.current_value == 'Суббота' %}selected{% endif %}>Суббота</option>
                                    <option value="Воскресенье" {% if column.current_value == 'Воскресенье' %}selected{% endif %}>Воскресенье</option>
                                </select>
                            {% elif column.data_type == 'integer' %}
                                <input type="number" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% elif column.data_type == 'numeric' %}
                                <input type="number" step="0.01" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% else %}
                                <input type="text" class="form-control" id="{{ column.name }}" 
                                       name="{{ column.name }}" value="{{ column.current_value }}"
                                       {% if not column.is_nullable %}required{% endif %}>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <p>Нет данных для редактирования</p>
                {% endif %}
            </div>
        </div>
        
        <div class="d-flex justify-content-between">
            <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">Отмена</a>
            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
        </div>
    </form>
</div>
{% endblock %}